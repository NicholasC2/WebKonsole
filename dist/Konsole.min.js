(()=>{var p=class{constructor(e,t=async()=>"Command is missing a run function."){this.alias=e,this.run=t}},u=[];function d(){return[...u]}function r(n,e){if(!n||n.trim()=="")throw new SyntaxError("Command must have alias");if(n.includes(" "))throw new SyntaxError("Command alias cannot contain spaces");if(u.some(i=>i.alias===n))throw new Error(`Command ${n} already exists`);u.push(new p(n,e))}function g(n){let e=u.findIndex(t=>t.alias===n);e!==-1&&u.splice(e,1)}function y(){r("echo",async function(n){return n.length===0?"<err>Usage: echo <text></err>":n.join(" ")}),r("clear",async function(n){if(n[0]=="--help")return"Clears the terminal screen.";this.container.innerHTML=""}),r("wait",async function(n){if(n[0]=="--help")return"Delays for a specified amount of milliseconds";{let e=parseInt(n[0],10);if(isNaN(e)||e<0)return"<err>Usage: wait <milliseconds></err>";await new Promise(t=>setTimeout(t,e))}}),r("help",async function(n){return n[0]=="--help"?"Displays all available commands":`Available Commands:
`+u.map(e=>`  ${e.alias}`).join(`
`)}),r("ver",async function(){return["Konsole Info:","  Version : {version}","  Branch  : {branch}","  Dev     : NicholasC"].join(`
`)}),r("nl",async function(n){return n[0]=="--help"?"Prints a new line":`
`}),r("vars",async function(n){if(n[0]=="--help")return"Lists all variables.";{let e=Object.entries(this.options.variables);return e.length===0?"<err>No variables defined.</err>":`Available Variables:
`+e.map(([t,i])=>`  ${t} = ${i.includes(`
`)?`[${i.split(`
`)[0]}...]`:i}`).join(`
`)}}),r("about",async function(){return["For use where a console is needed on the web","  Created by: NicholasC","  ASCII Art Source: {ascii_gen}"].join(`
`)}),r("set",async function(n){if(n[0]=="--help")return"Sets a variable for use in commands.";{if(n.length<2)return"<err>Usage: set <variable> <value></err>";let[e,...t]=n,i=t.join(" ");return this.options.variables[e]=i,`Variable ${e} set to "${i}"`}}),r("run",async function(n){if(n[0]=="--help")return'Runs a ".js" script.';try{if(n.length<1)return"<err>Usage: run <script location></err>";let e=await fetch(n[0]);if(!e.ok)return"<err>Inaccessible script location</err>";let t=await e.text(),i=new Blob([t],{type:"text/javascript"}),s=URL.createObjectURL(i),o=await import(s);return URL.revokeObjectURL(s),typeof o.default!="function"?"<err>Script has no default function</err>":await o.default.call(this)}catch(e){return e instanceof Error?`<err>Error running script: ${e.message}</err>`:`<err>Error running script: ${String(e)}</err>`}}),r("pause",async function(n){return n[0]=="--help"?"pauses until the user presses enter.":(this.update("Press enter to continue..."),new Promise(e=>{this.container.addEventListener("keydown",t=>{t.key=="Enter"&&e()})}))})}function b(n,e){let t=[],i="",s=!1,o=!1,l=!1;for(let c=0;c<n.length;c++){let a=n[c];if(l){i+=a,l=!1;continue}if(a==="\\"){l=!0;continue}if(a==="'"&&!o){s=!s;continue}if(a==='"'&&!s){o=!o;continue}a===e&&!s&&!o?(i.trim()&&t.push(i.trim()),i=""):i+=a}return i.trim()&&t.push(i.trim()),t}var v={version:"1.0.06",version_ascii:`:::    ::: ::::::::  ::::    :::  ::::::::   ::::::::  :::        :::::::::: 
:+:   :+: :+:    :+: :+:+:   :+: :+:    :+: :+:    :+: :+:        :+:        
+:+  +:+  +:+    +:+ :+:+:+  +:+ +:+        +:+    +:+ +:+        +:+        
+#++:++   +#+    +:+ +#+ +:+ +#+ +#++:++#++ +#+    +:+ +#+        +#++:++#   
+#+  +#+  +#+    +#+ +#+  +#+#+#        +#+ +#+    +#+ +#+        +#+        
#+#   #+# #+#    #+# #+#   #+#+# #+#    #+# #+#    #+# #+#        #+#        
###    ### ########  ###    ####  ########   ########  ########## ########## `,ascii_gen:"https://patorjk.com/software/taag/",branch:"stable"},x={"background-color":"black","box-sizing":"border-box",color:"lime",cursor:"text","font-family":"monospace","white-space":"pre-wrap","overflow-wrap":"break-word",padding:"5px",width:"100%",height:"100%","overflow-y":"auto","text-align":"left"},f=class{constructor({initCommand:e,prefix:t,cursor:i,variables:s}={}){this.initCommand=e!=null?e:"echo {version_ascii};echo v{version}-{branch};echo https://github.com/NicholasC2/WebKonsole",this.prefix=t!=null?t:"$ ",this.cursor=i!=null?i:"_",this.variables=Object.assign(v,s)}},m=class{constructor(e,t){this.focused=!1;this.commandRunning=!1;this.exitCommand=!1;this.createCommand=r;this.deleteCommand=g;this.getCommands=d;this.container=e,this.options=new f(t),this.container.classList.add("konsole-defaults");let i=Object.entries(x).map(([o,l])=>`${o}: ${l};`).join(" "),s=document.createElement("style");s.textContent=`.konsole-defaults { ${i} }`,document.head.insertBefore(s,document.head.firstChild),y(),this.cursor={element:document.createElement("div"),blinkTime:0,visible:!1},this.input={element:document.createElement("div"),previous:"",text:""},this.history={index:0,entries:[]},this.input.element.style.display="inline",this.container.appendChild(this.input.element),this.cursor.element.style.userSelect="none",this.container.appendChild(this.cursor.element),this.setupInputHandler(),this.startBlink(),this.runCommand(this.options.initCommand)}async formatInput(e){let t="";do{t=e;for(let[i,s]of Object.entries(this.options.variables))e=e.replaceAll(`{${i}}`,s)}while(e!==t);return e.replaceAll("\\n",`
`)}formatOutput(e){let t=e.replaceAll(/&/g,"&amp;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;");return t=t.replaceAll(/&lt;c:([^&]+?)&gt;([\s\S]*?)&lt;\/c&gt;/g,(i,s,o)=>`<span style="color:${s}">${o}</span>`),t=t.replaceAll(/&lt;err&gt;([\s\S]*?)&lt;\/err&gt;/g,(i,s)=>`<span style="color:red">${s}</span>`),t=t.replaceAll(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" rel="noopener noreferrer" style="color:#4f4ff7">$1</a>'),t}startBlink(){setInterval(()=>{this.cursor.blinkTime+=100,this.cursor.blinkTime>=500&&(this.cursor.visible=!this.cursor.visible,this.cursor.blinkTime=0,this.update())},100)}setupInputHandler(){this.container.setAttribute("tabindex","0"),this.container.addEventListener("keydown",async e=>{if(e.ctrlKey&&e.key.toLowerCase()=="c"){this.exitCommand=!0,this.container.innerText!=""&&this.update(`
`),this.update(this.options.prefix),this.commandRunning=!1;return}if(this.commandRunning)return;e.preventDefault(),this.resetCursorBlink();let t=this.input.text;switch(e.key){case"Enter":e.shiftKey?this.input.text+=`
`:(this.input.text="",this.update(t),t.trim()&&(this.history.entries[0]!==t&&this.history.entries.unshift(t),this.history.index=0),await this.runCommand(t));break;case"Backspace":this.input.text=t.slice(0,-1);break;case"ArrowUp":this.navigateHistory(-1);break;case"ArrowDown":this.navigateHistory(1);break;default:if(e.ctrlKey&&e.key.toLowerCase()==="l")this.container.innerHTML="";else if(e.ctrlKey&&e.key.toLowerCase()==="v"){let i=await navigator.clipboard.readText();this.input.text+=i}else e.key.length===1&&!e.ctrlKey&&!e.altKey&&(this.input.text+=e.key);break}this.scrollToBottom(),this.update()}),this.container.addEventListener("focus",()=>{this.focused=!0,this.resetCursorBlink(),this.update()}),this.container.addEventListener("blur",()=>{this.focused=!1,this.update()})}resetCursorBlink(){this.cursor.visible=!0,this.cursor.blinkTime=0}navigateHistory(e){this.history.index=Math.max(0,Math.min(this.history.index-e,this.history.entries.length));let t=this.history.entries[this.history.index-1]||"";this.input.text=t}scrollToBottom(){this.container.scrollTop=this.container.scrollHeight}update(...e){let t=[];return e.forEach(i=>{let s=document.createElement("span");s.innerHTML=this.formatOutput(i),t.push(s),this.container.appendChild(s)}),this.input.text!=this.input.previous&&(this.input.element.innerText=this.input.text,this.input.previous=this.input.text,this.container.appendChild(this.input.element)),this.focused&&this.cursor.visible&&!this.commandRunning?this.cursor.element.style.display!="inline"&&(this.cursor.element.style.display="inline"):this.cursor.element.style.display!="none"&&(this.cursor.element.style.display="none"),this.cursor.element.innerText=this.options.cursor,this.container.appendChild(this.cursor.element),t}async runCommand(e="",t=!1){this.exitCommand=!1,this.commandRunning=!0,this.cursor.visible=!1,this.update();let i=b(e,";");for(let s of i){let l=(await this.formatInput(s)).split(" "),c=l.shift();if(!c)continue;let a=d().find(h=>h.alias==c);if(this.container.innerText!=""&&this.update(`
`),a){if(this.exitCommand)return;let h=await a.run.call(this,l);if(this.exitCommand)return;h&&this.update(await this.formatInput(h))}else this.update(`<err>Unknown command: "${c}"</err>`)}this.exitCommand||(this.container.innerText!=""&&this.update(`
`),t||this.update(this.options.prefix),this.commandRunning=!1)}};globalThis.Konsole=m;})();
